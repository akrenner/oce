<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>6. Subclassing oce objects • oce</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="6. Subclassing oce objects">
<meta property="og:description" content="oce">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">oce</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.4-0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/oce.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/adp.html">3. Analysis of acoustic-Doppler data</a>
    </li>
    <li>
      <a href="../articles/ctd.html">2. Analysis of CTD data</a>
    </li>
    <li>
      <a href="../articles/flags.html">5. Dealing with data-quality flags</a>
    </li>
    <li>
      <a href="../articles/map_projections.html">4. Using map projections</a>
    </li>
    <li>
      <a href="../articles/subclassing.html">6. Subclassing oce objects</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dankelley/oce/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="subclassing_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>6. Subclassing oce objects</h1>
                        <h4 class="author">Dan Kelley (<a href="https://orcid.org/0000-0001-7808-5911" class="uri">https://orcid.org/0000-0001-7808-5911</a>)</h4>
            
            <h4 class="date">2021-03-27</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/dankelley/oce/blob/master/vignettes/subclassing.Rmd"><code>vignettes/subclassing.Rmd</code></a></small>
      <div class="hidden name"><code>subclassing.Rmd</code></div>

    </div>

    
    
<!-- HOW TO BUILD THE VIGNETTE. -->
<!-- Look in oce.Rmd for instructions. -->
<p><strong>Abstract.</strong> This vignette explains how new classes of objects can be created, using oce objects as a base class. The advantage of this is that the newly-formed objects will automatically have important properties of oce objects, in terms of operators such as <code><a href="https://rdrr.io/r/base/Extract.html">[[</a></code> and <code>[[&lt;-</code>, functions such as <code><a href="https://rdrr.io/r/base/subset.html">subset()</a></code> and <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code>, schemes for handling units, etc.</p>
<div id="initializing-oce-objects" class="section level2">
<h2 class="hasAnchor">
<a href="#initializing-oce-objects" class="anchor"></a>Initializing oce objects</h2>
<p>Oce handles a wide variety of data types, creating sub-classes the inherit from the base class that is named <code>oce</code>. However, even if a dataset does not fit within these sub-classes, it is still possible to use some of the features of <code>oce</code>, such as accessors, plotting, and summaries.</p>
<p>For example, suppose that there is a dataset that contains two variables, <code>mm</code> and <code>ss</code>, that have been measured at times <code>t</code>. Suppose that the data are recorded at a fixed location. To illustrate how to deal with such data, we first create some fake data:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lon</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">60</span>
<span class="va">lat</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">30</span>
<span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="st">"2017-08-30"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="st">"2017-09-01"</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"15 min"</span><span class="op">)</span>
<span class="va">tsec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span>
<span class="va">u</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">tsec</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">/</span> <span class="op">(</span><span class="fl">3600</span> <span class="op">*</span> <span class="fl">12.4206</span><span class="op">)</span><span class="op">)</span>
<span class="va">v</span> <span class="op">&lt;-</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="va">tsec</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">/</span> <span class="op">(</span><span class="fl">3600</span> <span class="op">*</span> <span class="fl">12.4206</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>These may be inserted into an <code>oce</code> object as follows. First, create the object.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dankelley.github.io/oce/">oce</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: gsw</span>
<span class="co">#&gt; Loading required package: testthat</span>
<span class="co">#&gt; Loading required package: sf</span>
<span class="co">#&gt; Linking to GEOS 3.8.1, GDAL 3.1.4, PROJ 6.3.1</span>
<span class="va">o</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="st">"oce"</span><span class="op">)</span></code></pre></div>
<p>This contains slots without data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">o</span><span class="op">)</span>
<span class="co">#&gt; Formal class 'oce' [package "oce"] with 3 slots</span>
<span class="co">#&gt;   ..@ metadata     :List of 2</span>
<span class="co">#&gt;   .. ..$ units: list()</span>
<span class="co">#&gt;   .. ..$ flags: list()</span>
<span class="co">#&gt;   ..@ data         : list()</span>
<span class="co">#&gt;   ..@ processingLog:List of 2</span>
<span class="co">#&gt;   .. ..$ time : POSIXct[1:1], format: "2021-03-27 21:51:11"</span>
<span class="co">#&gt;   .. ..$ value: chr "Create oce object"</span></code></pre></div>
<p>As noted previously, it’s possible to insert <code>t</code>, <code>u</code>, and <code>v</code> directly into the <code>data</code> slot, but it’s better to use <code>oceSetData</code> to do that, because it can set up units, and it leaves a trail in the processing log.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oceSetData.html">oceSetData</a></span><span class="op">(</span><span class="va">o</span>, <span class="st">"t"</span>, <span class="va">t</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>unit<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span>, scale<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span>
<span class="va">o</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oceSetData.html">oceSetData</a></span><span class="op">(</span><span class="va">o</span>, <span class="st">"u"</span>, <span class="va">u</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>unit<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">m</span><span class="op">/</span><span class="va">s</span><span class="op">)</span>, scale<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span>
<span class="va">o</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oceSetData.html">oceSetData</a></span><span class="op">(</span><span class="va">o</span>, <span class="st">"v"</span>, <span class="va">v</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>unit<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">m</span><span class="op">/</span><span class="va">s</span><span class="op">)</span>, scale<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Astute readers will realize that these data are akin to tidal velocities, and so might agree with the author that <code>lon</code> and <code>lat</code> belong in the <code>metadata</code> slot, not the <code>data</code> slot.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oceSetMetadata.html">oceSetMetadata</a></span><span class="op">(</span><span class="va">o</span>, <span class="st">"longitude"</span>, <span class="va">lon</span><span class="op">)</span>
<span class="va">o</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oceSetMetadata.html">oceSetMetadata</a></span><span class="op">(</span><span class="va">o</span>, <span class="st">"latitude"</span>, <span class="va">lat</span><span class="op">)</span></code></pre></div>
<p>At this stage, <code>o</code> is a full-fledged <code>oce</code> object. It may be summarized with</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">o</span><span class="op">)</span>
<span class="co">#&gt; * Data Overview</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                   Min.       Mean       Max. Dim. NAs OriginalName</span>
<span class="co">#&gt;     t [s]   1504062000 1504148400 1504234800  193   0            -</span>
<span class="co">#&gt;     u [m/s]   -0.99982  -0.027415          1  193   0            -</span>
<span class="co">#&gt;     v [m/s]   -0.49996 -0.0048211    0.49998  193   0            -</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; * Processing Log</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     - 2021-03-27 21:51:11 UTC: `Create oce object`</span>
<span class="co">#&gt;     - 2021-03-27 21:51:11 UTC: `oceSetData(object = o, name = "t", value = t, unit = list(unit = expression(s),     scale = ""))`</span>
<span class="co">#&gt;     - 2021-03-27 21:51:11 UTC: `oceSetData(object = o, name = "u", value = u, unit = list(unit = expression(m/s),     scale = ""))`</span>
<span class="co">#&gt;     - 2021-03-27 21:51:11 UTC: `oceSetData(object = o, name = "v", value = v, unit = list(unit = expression(m/s),     scale = ""))`</span>
<span class="co">#&gt;     - 2021-03-27 21:51:11 UTC: `oceSetMetadata(object = o, name = "longitude", value = lon)`</span>
<span class="co">#&gt;     - 2021-03-27 21:51:11 UTC: `oceSetMetadata(object = o, name = "latitude", value = lat)`</span></code></pre></div>
<p>and individual data components may be extracted with the <code><a href="https://rdrr.io/r/base/Extract.html">[[</a></code> notation</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">o</span><span class="op">[[</span><span class="st">"latitude"</span><span class="op">]</span><span class="op">]</span>                        <span class="co"># from metadata</span>
<span class="co">#&gt; [1] -30</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">o</span><span class="op">[[</span><span class="st">"t"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>                         <span class="co"># from data</span>
<span class="co">#&gt; [1] "2017-08-30 00:00:00 ADT" "2017-08-30 00:15:00 ADT"</span>
<span class="co">#&gt; [3] "2017-08-30 00:30:00 ADT" "2017-08-30 00:45:00 ADT"</span>
<span class="co">#&gt; [5] "2017-08-30 01:00:00 ADT" "2017-08-30 01:15:00 ADT"</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">o</span><span class="op">[[</span><span class="st">"u"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.9961884 0.9772306 0.9426639 0.8930403 0.8291526 0.7520211</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">o</span><span class="op">[[</span><span class="st">"v"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; [1] -0.04361357 -0.10608997 -0.16687184 -0.22498833 -0.27951117 -0.32956949</span></code></pre></div>
<p>A crude plot can be done with</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">o</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="subclassing_files/figure-html/unnamed-chunk-10-1.png" alt="**Figure 11.** Crude plot of constructed `oce` object." width="288"><p class="caption">
<strong>Figure 11.</strong> Crude plot of constructed <code>oce</code> object.
</p>
</div>
<p>Note that the plot uses the <code>pairs</code> function to show how all elements of the <code>data</code> slot vary with each other. To customize the plot, a new object class should be created, as in the next section.</p>
</div>
<div id="creating-new-oce-object-classes" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-new-oce-object-classes" class="anchor"></a>Creating new oce object classes</h2>
<p>Let’s call this new object class <code>uv</code>. With this, inventing a new object sub-class is as simple as invoking</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">setClass</span><span class="op">(</span><span class="st">"uv"</span>, contains<span class="op">=</span><span class="st">"oce"</span><span class="op">)</span></code></pre></div>
<p>For most objects, it makes sense to define three specialized methods: one to create new objects (called <code>"initialize"</code>), one to plot them (<code>"plot"</code>), and one to summarize them (<code>"summary"</code>).</p>
<p>The initialization can be handled with</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">setMethod</span><span class="op">(</span>f<span class="op">=</span><span class="st">"initialize"</span>,
          signature<span class="op">=</span><span class="st">"uv"</span>,
          definition<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">.Object</span>, <span class="va">time</span>, <span class="va">u</span>, <span class="va">v</span>, <span class="va">longitude</span>, <span class="va">latitude</span><span class="op">)</span> <span class="op">{</span>
              <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html">missing</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"must provide 'time'"</span><span class="op">)</span>
              <span class="co">## repeat the above also for u, v, longitude, and latitude</span>
              <span class="va">.Object</span><span class="op">@</span><span class="va">metadata</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">u</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>unit<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">m</span><span class="op">/</span><span class="va">s</span><span class="op">)</span>, scale<span class="op">=</span><span class="st">""</span><span class="op">)</span>
              <span class="va">.Object</span><span class="op">@</span><span class="va">metadata</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">v</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>unit<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">m</span><span class="op">/</span><span class="va">s</span><span class="op">)</span>, scale<span class="op">=</span><span class="st">""</span><span class="op">)</span>
              <span class="va">.Object</span><span class="op">@</span><span class="va">metadata</span><span class="op">$</span><span class="va">longitude</span> <span class="op">&lt;-</span> <span class="va">longitude</span>
              <span class="va">.Object</span><span class="op">@</span><span class="va">metadata</span><span class="op">$</span><span class="va">latitude</span> <span class="op">&lt;-</span> <span class="va">latitude</span>
              <span class="va">.Object</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">time</span> <span class="op">&lt;-</span> <span class="va">time</span>
              <span class="va">.Object</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">u</span> <span class="op">&lt;-</span> <span class="va">u</span>
              <span class="va">.Object</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">v</span> <span class="op">&lt;-</span> <span class="va">v</span>
              <span class="va">.Object</span><span class="op">@</span><span class="va">processingLog</span><span class="op">$</span><span class="va">time</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/presentTime.html">presentTime</a></span><span class="op">(</span><span class="op">)</span>
              <span class="va">.Object</span><span class="op">@</span><span class="va">processingLog</span><span class="op">$</span><span class="va">value</span> <span class="op">&lt;-</span> <span class="st">"create 'uv' object"</span>
              <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">.Object</span><span class="op">)</span>
          <span class="op">}</span><span class="op">)</span></code></pre></div>
<p>This is fairly arcane, but simply copying and pasting this will be enough to get the reader started. Let’s try it:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">oo</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="st">"uv"</span>, <span class="va">t</span>, <span class="va">u</span>, <span class="va">v</span>, <span class="va">lon</span>, <span class="va">lat</span><span class="op">)</span></code></pre></div>
<p>Next, customize <code>summary</code> for this new class:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">setMethod</span><span class="op">(</span>f<span class="op">=</span><span class="st">"summary"</span>,
          signature<span class="op">=</span><span class="st">"uv"</span>,
          definition<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
              <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"uv Summary\n-----------\n\n"</span>, <span class="va">...</span><span class="op">)</span>
              <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"* Location:           "</span>,
                        <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"%.5f N"</span>, <span class="va">object</span><span class="op">@</span><span class="va">metadata</span><span class="op">$</span><span class="va">latitude</span><span class="op">)</span>, <span class="st">", "</span>,
                        <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"%.5f E"</span>, <span class="va">object</span><span class="op">@</span><span class="va">metadata</span><span class="op">$</span><span class="va">longitude</span><span class="op">)</span>, <span class="st">"\n"</span>, sep<span class="op">=</span><span class="st">''</span><span class="op">)</span><span class="op">)</span>
              <span class="fu">callNextMethod</span><span class="op">(</span><span class="op">)</span>
          <span class="op">}</span><span class="op">)</span></code></pre></div>
<p>The <code>callNextMethod</code> will summarize the entries in the <code>data</code> slot adequately for this case. Let’s try it:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">oo</span><span class="op">)</span>
<span class="co">#&gt; uv Summary</span>
<span class="co">#&gt; -----------</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; * Location:           -30.00000 N, -60.00000 E</span>
<span class="co">#&gt; * Time ranges from 2017-08-30 to 2017-09-01 with 193 samples and mean increment 15 min</span>
<span class="co">#&gt; * Data Overview</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                 Min.       Mean    Max. Dim. NAs OriginalName</span>
<span class="co">#&gt;     u [m/s] -0.99982  -0.027415       1  193   0            -</span>
<span class="co">#&gt;     v [m/s] -0.49996 -0.0048211 0.49998  193   0            -</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; * Processing Log</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     - 2021-03-27 21:51:12 UTC: `create 'uv' object`</span>
<span class="co">#&gt; NULL</span></code></pre></div>
<p>Finally, let’s make a custom method for <code>plot</code>. This is usually the most complicated part of handling any new object class, because there are usually many ways to look at data. (Some <code>oce</code> objects have over a dozen specialized plot styles.) Let’s suppose there are only two desired plot styles: one showing timeseries of <code>u</code> and <code>v</code> in a two panel plot, and the other showing how <code>u</code> and <code>v</code> covary.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">setMethod</span><span class="op">(</span>f<span class="op">=</span><span class="st">"plot"</span>,
          signature<span class="op">=</span><span class="fu">signature</span><span class="op">(</span><span class="st">"uv"</span><span class="op">)</span>,
          definition<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">which</span><span class="op">=</span><span class="fl">1</span>, <span class="va">...</span><span class="op">)</span>
          <span class="op">{</span>
              <span class="kw">if</span> <span class="op">(</span><span class="va">which</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span>
                  <span class="fu"><a href="../reference/oce.plot.ts.html">oce.plot.ts</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="st">"time"</span><span class="op">]</span><span class="op">]</span>, <span class="va">x</span><span class="op">[[</span><span class="st">"u"</span><span class="op">]</span><span class="op">]</span>, ylab<span class="op">=</span><span class="st">"u [m/s]"</span>, <span class="va">...</span><span class="op">)</span>
              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">which</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span>
                  <span class="fu"><a href="../reference/oce.plot.ts.html">oce.plot.ts</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="st">"time"</span><span class="op">]</span><span class="op">]</span>, <span class="va">x</span><span class="op">[[</span><span class="st">"v"</span><span class="op">]</span><span class="op">]</span>, ylab<span class="op">=</span><span class="st">"v [m/s]"</span>, <span class="va">...</span><span class="op">)</span>
              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">which</span> <span class="op">==</span> <span class="fl">3</span><span class="op">)</span> <span class="op">{</span>
                  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="st">"u"</span><span class="op">]</span><span class="op">]</span>, <span class="va">x</span><span class="op">[[</span><span class="st">"v"</span><span class="op">]</span><span class="op">]</span>, xlab<span class="op">=</span><span class="st">"u [m/s]"</span>, ylab<span class="op">=</span><span class="st">"v [m/s]"</span>, <span class="va">...</span><span class="op">)</span>
              <span class="op">}</span>
          <span class="op">}</span><span class="op">)</span></code></pre></div>
<p>An now, we can try it out</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">oo</span>, which<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">oo</span>, which<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="subclassing_files/figure-html/unnamed-chunk-18-1.png" alt="**Figure 12.** Time-series u(t) plot of newly-constructed `uv` object." width="288"><p class="caption">
<strong>Figure 12.</strong> Time-series u(t) plot of newly-constructed <code>uv</code> object.
</p>
</div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">oo</span>, which<span class="op">=</span><span class="fl">3</span>, asp<span class="op">=</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="subclassing_files/figure-html/unnamed-chunk-19-1.png" alt="**Figure 13.** Hodograph plot of newly-constructed `uv` object." width="288"><p class="caption">
<strong>Figure 13.</strong> Hodograph plot of newly-constructed <code>uv</code> object.
</p>
</div>
</div>
<div id="tutorial" class="section level1">
<h1 class="hasAnchor">
<a href="#tutorial" class="anchor"></a>Tutorial</h1>
<div id="defining-a-class" class="section level2">
<h2 class="hasAnchor">
<a href="#defining-a-class" class="anchor"></a>Defining a class</h2>
<p>The <code>setClass</code> function is the key to defining a new class. Entering <code>?setClass</code> in an R console reveals the details of this function, including some notes on how it has evolved since R version 3.0.</p>
<p>We need only a simple form here, with</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dankelley.github.io/oce/">oce</a></span><span class="op">)</span>
<span class="va">wave</span> <span class="op">&lt;-</span> <span class="kw">setClass</span><span class="op">(</span>Class<span class="op">=</span><span class="st">"wave"</span>, contains<span class="op">=</span><span class="st">"oce"</span><span class="op">)</span></code></pre></div>
<p>being enough to create a new class called <code>wave</code> that inherits the base features of the <code>oce</code> class.</p>
<p>To create a new object that inherits from the <code>wave</code> class, use e.g.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="st">"wave"</span><span class="op">)</span></code></pre></div>
</div>
<div id="examining-an-object" class="section level2">
<h2 class="hasAnchor">
<a href="#examining-an-object" class="anchor"></a>Examining an object</h2>
<p>We can see that <code>w</code> inherits from the <code>oce</code> class with</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">w</span><span class="op">)</span>
<span class="co">#&gt; [1] "wave"</span>
<span class="co">#&gt; attr(,"package")</span>
<span class="co">#&gt; [1] ".GlobalEnv"</span></code></pre></div>
<p>and a check that is common to see in code is</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html">inherits</a></span><span class="op">(</span><span class="va">w</span>, <span class="st">"wave"</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>The contents of the object are revealed with</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">w</span><span class="op">)</span>
<span class="co">#&gt; Formal class 'wave' [package ".GlobalEnv"] with 3 slots</span>
<span class="co">#&gt;   ..@ metadata     :List of 2</span>
<span class="co">#&gt;   .. ..$ units: list()</span>
<span class="co">#&gt;   .. ..$ flags: list()</span>
<span class="co">#&gt;   ..@ data         : list()</span>
<span class="co">#&gt;   ..@ processingLog:List of 2</span>
<span class="co">#&gt;   .. ..$ time : POSIXct[1:1], format: "2021-03-27 21:51:13"</span>
<span class="co">#&gt;   .. ..$ value: chr "Create oce object"</span></code></pre></div>
<p>Notice that <code>w</code> three <code>oce</code> “slots”, named <code>metadata</code>, <code>data</code> and <code>processingLog</code>. These are inherited from <code>oce</code>. The first is meant to hold information about the data, such as a file-name, an instrument number, a location of sampling, etc. The second is meant to hold actual data or measurements. And the third, not normally accessed by the user directly, holds information about the object’s evolution (note that the object considers itself an <code>oce</code> object). The names of these three slots are usually enough to keep them straight in the analyst’s head, although it can sometimes be difficult deciding whether something belongs in <code>metadata</code> or <code>data</code>.</p>
<p>The <code>oce</code> system also provides its objects with certain operators and functions. For example, <code><a href="https://rdrr.io/r/base/Extract.html">[[</a></code> can be used to retrieve the slots, items within the slots, and (in some cases) values that may be calculated from the contents of the slots (e.g. <code>ctd</code> and similar objects related to hydrography can return calculated potential temperature or Conservative Temperature, even though neither is typically stored in such datasets).</p>
<p>That’s not the only thing. All <code>oce</code> objects give special powers to the <code><a href="https://rdrr.io/r/base/Extract.html">[[</a></code> operator, e.g. we can retrieve the <code>metadata</code> slot with</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">w</span><span class="op">[[</span><span class="st">"metadata"</span><span class="op">]</span><span class="op">]</span>
<span class="co">#&gt; $units</span>
<span class="co">#&gt; list()</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $flags</span>
<span class="co">#&gt; list()</span></code></pre></div>
<p>and the same for the data slot</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">w</span><span class="op">[[</span><span class="st">"data"</span><span class="op">]</span><span class="op">]</span>
<span class="co">#&gt; list()</span></code></pre></div>
</div>
<div id="adding-data-to-objects" class="section level2">
<h2 class="hasAnchor">
<a href="#adding-data-to-objects" class="anchor"></a>Adding data to objects</h2>
<p>The <code>[[&lt;-</code> operator can be used to fill the slots with information, e.g. we could insert a station location of <code>"STN01"</code> with</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">w</span><span class="op">[[</span><span class="st">"metadata"</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">station</span> <span class="op">&lt;-</span> <span class="st">"STN01"</span></code></pre></div>
<p>and verify that this worked with</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">w</span><span class="op">)</span>
<span class="co">#&gt; Formal class 'wave' [package ".GlobalEnv"] with 3 slots</span>
<span class="co">#&gt;   ..@ metadata     :List of 3</span>
<span class="co">#&gt;   .. ..$ units  : list()</span>
<span class="co">#&gt;   .. ..$ flags  : list()</span>
<span class="co">#&gt;   .. ..$ station: chr "STN01"</span>
<span class="co">#&gt;   ..@ data         : list()</span>
<span class="co">#&gt;   ..@ processingLog:List of 2</span>
<span class="co">#&gt;   .. ..$ time : POSIXct[1:1], format: "2021-03-27 21:51:13"</span>
<span class="co">#&gt;   .. ..$ value: chr "Create oce object"</span></code></pre></div>
<p>However, there is a better way to insert metadata, with the <code>oceSetMetadata</code> function, e.g.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oceSetMetadata.html">oceSetMetadata</a></span><span class="op">(</span><span class="va">w</span>, <span class="st">"serialNumber"</span>, <span class="fl">1234</span><span class="op">)</span></code></pre></div>
<p>sets the serial number to 1234, and</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">w</span><span class="op">[[</span><span class="st">"metadata"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; List of 4</span>
<span class="co">#&gt;  $ units       : list()</span>
<span class="co">#&gt;  $ flags       : list()</span>
<span class="co">#&gt;  $ station     : chr "STN01"</span>
<span class="co">#&gt;  $ serialNumber: num 1234</span></code></pre></div>
<p>verifies that this worked.</p>
<p>Now, let’s insert some data. Imagine a half-minute dataset with 10Hz sampling, for a signal with a <span class="math inline">\(1\)</span>m elevation wave with period <span class="math inline">\(10\)</span>s, plus some noise of order <span class="math inline">\(1\)</span>cm.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="st">"2019-01-01 00:00:00"</span>, tz<span class="op">=</span><span class="st">"UTC"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">30</span>, length.out<span class="op">=</span><span class="fl">100</span><span class="op">)</span>
<span class="va">tau</span> <span class="op">&lt;-</span> <span class="fl">10</span>
<span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">/</span> <span class="va">tau</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">t</span>, sd<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span></code></pre></div>
<p>(Notice that we are not using the R <code>ts</code> form to make this time-series. This is because oceanographic data are commonly acquired on an irregular time interval, so it makes sense to store observation time explicitly, instead of using the start/step/stop approach of the <code>ts</code> scheme.)</p>
<p>These data may be inserted into our object with</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oceSetData.html">oceSetData</a></span><span class="op">(</span><span class="va">w</span>, <span class="st">"time"</span>, <span class="va">t</span><span class="op">)</span>
<span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oceSetData.html">oceSetData</a></span><span class="op">(</span><span class="va">w</span>, <span class="st">"elevation"</span>, <span class="va">e</span><span class="op">)</span></code></pre></div>
<p>At this point the reader is likely to use <code>str</code> to see if this worked, but since the object is starting to fill up, it might make sense to use the <code>summary</code> function, which is inherited from <code>oce</code>.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">w</span><span class="op">)</span>
<span class="co">#&gt; * Time ranges from 2019-01-01 to 2019-01-01 00:00:30 with 100 samples and mean increment 0.3030303 s</span>
<span class="co">#&gt; * Data Overview</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                  Min.        Mean   Max. Dim. NAs OriginalName</span>
<span class="co">#&gt;     elevation -0.9952 -0.00064121 1.0205  100   0            -</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; * Processing Log</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     - 2021-03-27 21:51:13 UTC: `Create oce object`</span>
<span class="co">#&gt;     - 2021-03-27 21:51:13 UTC: `oceSetMetadata(object = w, name = "serialNumber", value = 1234)`</span>
<span class="co">#&gt;     - 2021-03-27 21:51:14 UTC: `oceSetData(object = w, name = "time", value = t)`</span>
<span class="co">#&gt;     - 2021-03-27 21:51:14 UTC: `oceSetData(object = w, name = "elevation", value = e)`</span></code></pre></div>
<p>This produces a useful summary not just of the data, but also of how the object was constructed. But we can do better. In some crazy world, someone might consider measuring elevation in feet, not metres, and so we ought to specify the unit. The way to do this is with the <code>unit</code> argument of <code>oceSetData</code>. This is a somewhat tricky argument, as a study of the result of <code><a href="../reference/oceSetData.html">?oceSetData</a></code> will reveal. For now, we just show a common way, without explanation, writing</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oceSetData.html">oceSetData</a></span><span class="op">(</span><span class="va">w</span>, <span class="st">"elevation"</span>, <span class="va">e</span>, unit<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>unit<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>,scale<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>This over-rides the existing definition. Now, let’s look at the summary:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">w</span><span class="op">)</span>
<span class="co">#&gt; * Time ranges from 2019-01-01 to 2019-01-01 00:00:30 with 100 samples and mean increment 0.3030303 s</span>
<span class="co">#&gt; * Data Overview</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                      Min.        Mean   Max. Dim. NAs OriginalName</span>
<span class="co">#&gt;     elevation [m] -0.9952 -0.00064121 1.0205  100   0            -</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; * Processing Log</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     - 2021-03-27 21:51:13 UTC: `Create oce object`</span>
<span class="co">#&gt;     - 2021-03-27 21:51:13 UTC: `oceSetMetadata(object = w, name = "serialNumber", value = 1234)`</span>
<span class="co">#&gt;     - 2021-03-27 21:51:14 UTC: `oceSetData(object = w, name = "time", value = t)`</span>
<span class="co">#&gt;     - 2021-03-27 21:51:14 UTC: `oceSetData(object = w, name = "elevation", value = e)`</span>
<span class="co">#&gt;     - 2021-03-27 21:51:14 UTC: `oceSetData(object = w, name = "elevation", value = e, unit = list(unit = expression(m),     scale = ""))`</span></code></pre></div>
<p>Notice that we now have a unit on the elevation, but we  have an indication that the value of that quantity was defined twice. This processing-log feature is one of the big advantages of using <code>oceSetData</code> over direct insertion into an object.</p>
</div>
<div id="adding-specialized-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#adding-specialized-functions" class="anchor"></a>Adding specialized functions</h2>
<p>The most common function to add is a plot function. Since <code>plot</code> is a built-in function, we are subclassing it. The details of doing this are provided by <code>?setMethod</code>. Again, studying the documentation for that function would be worthwhile, but the gist is provided by a simple example, e.g.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">setMethod</span><span class="op">(</span>f<span class="op">=</span><span class="st">"plot"</span>,
    signature<span class="op">=</span><span class="fu">signature</span><span class="op">(</span><span class="st">"wave"</span><span class="op">)</span>,
    definition<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">which</span><span class="op">=</span><span class="fl">1</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
        <span class="kw">if</span> <span class="op">(</span><span class="va">which</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span>
            <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="st">"time"</span><span class="op">]</span><span class="op">]</span>, <span class="va">x</span><span class="op">[[</span><span class="st">"elevation"</span><span class="op">]</span><span class="op">]</span>, <span class="va">...</span><span class="op">)</span>
        <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">which</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span>
            <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="st">"elevation"</span><span class="op">]</span><span class="op">]</span>, <span class="va">...</span><span class="op">)</span>
        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
            <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"which must be 1 or 2"</span><span class="op">)</span>
        <span class="op">}</span>
    <span class="op">}</span><span class="op">)</span></code></pre></div>
<p>Here, the <code>signature</code> argument tells R that <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> called with a <code>wave</code> object as its first argument ought to use the indicated function. That function takes just two arguments: the object to be plotted, and <code>which</code>, an indication of the desired plot type.</p>
<p>For example, since <code>which</code> defaults to 1, we can get a popular plot with</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">w</span><span class="op">)</span></code></pre></div>
<p><img src="subclassing_files/figure-html/unnamed-chunk-37-1.png" width="700"></p>
<p>Note the simplicity of this action. The user has no reason to state what kind of object this is, because R detects the type and dispatches to the specialized <code>wave</code>-plotting function. This may seem like a small thing in the present context, but imagine an analyst writing code to analyse a wide variety of data types: it is very convenient to have a simple function call that works for each.</p>
<p>Since the <code>...</code> argument is passed into both the plotting methods. Thus, for example, a cleaner time-series plot might be created with</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">w</span>, type<span class="op">=</span><span class="st">"l"</span>, xlab<span class="op">=</span><span class="st">"Time [s]"</span>, ylab<span class="op">=</span><span class="st">"Elevation [m]"</span><span class="op">)</span></code></pre></div>
<p><img src="subclassing_files/figure-html/unnamed-chunk-38-1.png" width="700"></p>
</div>
</div>
<div id="advanced-methods" class="section level1">
<h1 class="hasAnchor">
<a href="#advanced-methods" class="anchor"></a>Advanced methods</h1>
<div id="initializing-objects-with-data" class="section level2">
<h2 class="hasAnchor">
<a href="#initializing-objects-with-data" class="anchor"></a>Initializing objects with data</h2>
<p>The following lets the user specify <code>time</code> and <code>elevation</code> when the object is created. It also permits a specification of units, with a default being to us metres.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">setMethod</span><span class="op">(</span>f<span class="op">=</span><span class="st">"initialize"</span>,
    signature<span class="op">=</span><span class="st">"wave"</span>,
    definition<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">.Object</span>, <span class="va">time</span>, <span class="va">elevation</span>, <span class="va">units</span><span class="op">)</span> <span class="op">{</span>
        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html">missing</a></span><span class="op">(</span><span class="va">units</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
            <span class="va">.Object</span><span class="op">@</span><span class="va">metadata</span><span class="op">$</span><span class="va">units</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
            <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html">missing</a></span><span class="op">(</span><span class="va">units</span><span class="op">)</span><span class="op">)</span>
                <span class="va">.Object</span><span class="op">@</span><span class="va">metadata</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">elevation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>unit<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>, scale<span class="op">=</span><span class="st">""</span><span class="op">)</span>
        <span class="op">}</span>
        <span class="va">.Object</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">time</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html">missing</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span><span class="op">)</span> <span class="cn">NULL</span> <span class="kw">else</span> <span class="va">time</span>
        <span class="va">.Object</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">elevation</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html">missing</a></span><span class="op">(</span><span class="va">elevation</span><span class="op">)</span><span class="op">)</span> <span class="cn">NULL</span> <span class="kw">else</span> <span class="va">elevation</span>
        <span class="va">.Object</span><span class="op">@</span><span class="va">processingLog</span><span class="op">$</span><span class="va">time</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/presentTime.html">presentTime</a></span><span class="op">(</span><span class="op">)</span>
        <span class="va">.Object</span><span class="op">@</span><span class="va">processingLog</span><span class="op">$</span><span class="va">value</span> <span class="op">&lt;-</span> <span class="st">"create 'wave' object"</span>
        <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">.Object</span><span class="op">)</span>
    <span class="op">}</span>
<span class="op">)</span></code></pre></div>
<p>A test proves that this works as hoped for.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ww</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="st">"wave"</span>, time<span class="op">=</span><span class="va">t</span>, elevation<span class="op">=</span><span class="va">e</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">ww</span><span class="op">)</span>
<span class="co">#&gt; * Time ranges from 2019-01-01 to 2019-01-01 00:00:30 with 100 samples and mean increment 0.3030303 s</span>
<span class="co">#&gt; * Data Overview</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                      Min.        Mean   Max. Dim. NAs OriginalName</span>
<span class="co">#&gt;     elevation [m] -0.9952 -0.00064121 1.0205  100   0            -</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; * Processing Log</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     - 2021-03-27 21:51:14 UTC: `create 'wave' object`</span></code></pre></div>
<p>Notice that the units now appear, without complication to the user. Oh, and this object now knows that it is a <code>wave</code> object, not an <code>oce</code> object  our little class is getting smarter by the minute!</p>
</div>
<div id="specializing-the-operator" class="section level2">
<h2 class="hasAnchor">
<a href="#specializing-the-operator" class="anchor"></a>Specializing the <code>[[</code> operator</h2>
<p>As in the previous section, the key of specializing how <code><a href="https://rdrr.io/r/base/Extract.html">[[</a></code> works is to use <code>setMethod()</code>, but this time the function is named <code>"[["</code>. Suppose we want to permit e.g. <code>w[["peak"]]</code> as a way to find the maximum value of wave height. This becomes a call to the <code>"[["</code> function, with first argument as <code>w</code>, and second argument as <code>"peak"</code>. We can handle this with:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">setMethod</span><span class="op">(</span>f<span class="op">=</span><span class="st">"[["</span>,
    <span class="fu">signature</span><span class="op">(</span>x<span class="op">=</span><span class="st">"wave"</span>, i<span class="op">=</span><span class="st">"ANY"</span>, j<span class="op">=</span><span class="st">"ANY"</span><span class="op">)</span>,
    definition<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">i</span>, <span class="va">j</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
        <span class="kw">if</span> <span class="op">(</span><span class="va">i</span> <span class="op">==</span> <span class="st">"peak"</span><span class="op">)</span> <span class="op">{</span>
           <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="st">"elevation"</span><span class="op">]</span><span class="op">]</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
           <span class="fu">callNextMethod</span><span class="op">(</span><span class="op">)</span>
        <span class="op">}</span>
    <span class="op">}</span>
<span class="op">)</span></code></pre></div>
<p>(The details of the <code>signature</code> definition are explained in the documentation provided by <code>?setMethod</code>, and readers ought to study that material before changing the <code>signature</code> definition.)</p>
<p>The important thing to focus on is the <code>if</code> block in the function definition. Called as e.g. <code>w[["peak"]]</code> causes <code>i</code> to equal <code>"peak"</code>, and so the return value will be the maximum elevation. However, in all other instances, the return values is provided by <code>callNextMethod()</code>, and what that does is to dig one level deeper for a way to handle <code><a href="https://rdrr.io/r/base/Extract.html">[[</a></code>. At that deeper level, it finds the <code>oce</code> definition, the details of which can be found with <code><a href="../reference/%5B%5B,oce-method.html">?"[[,oce-method"</a></code>.</p>
<p>The test</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">w</span><span class="op">[[</span><span class="st">"peak"</span><span class="op">]</span><span class="op">]</span>
<span class="co">#&gt; [1] 1.020547</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">w</span><span class="op">[[</span><span class="st">"elevation"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt;  num [1:100] -0.000501 0.188709 0.360313 0.563071 0.698986 ...</span></code></pre></div>
<p>verifies that our new code works for getting the peak value, and that it falls back to the <code>oce</code> code for other calls.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Dan Kelley, Clark Richards.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
